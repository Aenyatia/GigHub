@model GigsViewModel

<h1>@Model.Heading</h1>
<ul id="gigs" class="mt-5">
	@foreach (var gig in Model.UpcomingGigs)
	{
		<li>
			<div class="date">
				<div class="month">
					@gig.DateTime.ToString("MMM")
				</div>
				<div class="day">
					@gig.DateTime.Day.ToString("d")
				</div>
			</div>
			<div class="details">
				<span class="artist">
					@gig.Artist.Name

					@if (gig.IsCanceled)
					{
						<span class="badge badge-warning">Canceled</span>
					}

					@if (Model.ShowActions)
					{
						<button class="btn btn-sm btn-link js-toggle-follow" data-user-id="@gig.ArtistId">Follow</button>
					}
				</span>
				<span class="genre">
					@gig.Genre.Name
				</span>

				@if (Model.ShowActions && !gig.IsCanceled)
				{
					<button class="btn btn-sm btn-primary float-right js-toggle-attendance" data-gig-id="@gig.Id">Going?</button>
				}
			</div>
		</li>
	}
</ul>

@section scripts {
	<script>
		$(document).ready(function () {
			$(".js-toggle-attendance").click(function (e) {
				var button = $(e.target);
				$.ajax(
					{
						url: "/api/attendances",
						method: "POST",
						contentType: "application/json",
						data: JSON.stringify({
							gigId: button.attr("data-gig-id")
						})
					})
					.done(function () {
						button
							.removeClass("btn-primary")
							.addClass("btn-info")
							.text("Going");
					})
					.fail(function () {
						alert("Something failed!");
					});
			});

			$(".js-toggle-follow").click(function (e) {
				var button = $(e.target);
				$.ajax(
					{
						url: "/api/followings",
						method: "POST",
						contentType: "application/json",
						data: JSON.stringify({
							followeeId: button.attr("data-user-id")
						})
					})
					.done(function () {
						button.text("Following");
					})
					.fail(function () {
						alert("Something failed!");
					});
			});
		});
	</script>
}
